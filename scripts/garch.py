import matplotlib.pyplot as plt
from arch import arch_model
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf, pacf
import numpy as np
import io

def test():
    print("main running")

def get_pacf(returns: dict, alpha: float, n_lags: int):

    returns_list = list(returns.values())
    returns_list_np = np.array(returns_list)

    buf = get_pacf_imgPlot(returns_list_np, n_lags, alpha)

    return pacf_img

def get_pacf_imgPlot(returns, nlags, alpha):

    
    fig, ax = plt.subplots()
    plot_pacf(returns**2, ax=ax, lags=nlags, alpha=alpha)

    buf = io.BytesIO()
    fig.savefig(buf, format='png', bbox_inches='tight')
    plt.close(fig)
    buf.seek(0)

    return buf





if __name__ == "__main__":
    daily_returns = {
    "2024-01-03": -0.008200314302334042, "2024-01-04": -0.0032262237758721507,
    "2024-01-05": 0.0013687035171302203, "2024-01-08": 0.014175078369058847,
    "2024-01-09": -0.0015183303717830445, "2024-01-10": 0.005639509387016945,
    "2024-01-11": -0.0004406411204291736, "2024-01-12": 0.0006923674799863711,
    "2024-01-16": -0.0036778552475673853, "2024-01-17": -0.005574237429198089,

    "2024-01-18": 0.008853464140976819, "2024-01-19": 0.012389133124500911,
    "2024-01-22": 0.0021121872693184913, "2024-01-23": 0.002912233995876188,
    "2024-01-24": 0.0010924597375709718, "2024-01-25": 0.0054242038411854016,
    "2024-01-26": -0.0012711769154660723, "2024-01-29": 0.007888214692417331,
    "2024-01-30": -0.0007737878181719913, "2024-01-31": -0.016451939372570046,

    "2024-02-01": 0.013003310179418831, "2024-02-02": 0.010472286767422505,
    "2024-02-05": -0.0036477434923571713, "2024-02-06": 0.002899050094807743,
    "2024-02-07": 0.008305792971157265, "2024-02-08": 0.00044162362767539526,
    "2024-02-09": 0.0057627085921121675, "2024-02-12": -0.0004390235582892578,
    "2024-02-13": -0.013868722221148743, "2024-02-14": 0.009046535363742099,

    "2024-02-15": 0.00687606844616898, "2024-02-16": -0.004992427022211199,
    "2024-02-20": -0.005520611518135003, "2024-02-21": 0.0009053860982044098,
    "2024-02-22": 0.02048436881818936, "2024-02-23": 0.0006893204701895109,
    "2024-02-26": -0.003669216285443004, "2024-02-27": 0.0018559835928859418,
    "2024-02-28": -0.0013225253057347415, "2024-02-29": 0.003588552916024767,

    "2024-03-01": 0.009344491925002578, "2024-03-04": -0.0010730270535569055,
    "2024-03-05": -0.010044387639460363, "2024-03-06": 0.005054449414825066,
    "2024-03-07": 0.00987747958099822, "2024-03-08": -0.0060203039932941235,
    "2024-03-11": -0.0008602378388221707, "2024-03-12": 0.010699878096710396,
    "2024-03-13": -0.0015687880618816827, "2024-03-14": -0.0019786302667848077,
}
    get_pacf(daily_returns)