<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volatility Analysis</title>
    <style>
        /* === Existing & Global Styles === */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f0f2f5; /* Light overall background for the page */
        }

        .site-header {
            background-color: #e9e9e9;
            color: #333;
            border-bottom: 2px solid #b0b0b0;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            min-height: 50px;
        }

        .menu-container {
            position: relative;
            display: inline-block;
        }

        .menu-button {
            background-color: #555;
            color: white;
            border: 1px solid #333;
            padding: 8px 12px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .menu-button:hover { background-color: #333; }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000; /* Ensure dropdown is on top */
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 5px;
        }
        .dropdown-content p { padding: 12px 16px; margin: 0; color: #555; font-size: 0.9em; }
        .menu-container:hover .dropdown-content { display: block; }

        .header-title {
            flex-grow: 1;
            text-align: center;
            margin: 0 10px;
            font-size: 1.7em;
            font-weight: bold;
            color: #333;
        }

        /* General form element styling - can be overridden by more specific rules */
        input, button {
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 1em;
        }
        button {
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        button:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        label {
            margin-bottom: 3px;
            display: inline-block; /* Helps with alignment */
        }

        /* === Stock Info Form Area (Right Panel of Top Section) === */
        .form-box-container#stock-info-form-area { /* This is the container for the script-form */
            border: 1px solid #a0a0a0;
            padding: 20px; /* Reduced padding slightly */
            background-color: #ffffff;
            border-radius: 5px;
            /* max-width: 550px; /* This will be controlled by its flex container */
            margin: 0; /* Margin is handled by parent flex container */
        }

        #script-form h1 { /* Specific to the stock info form's h1 */
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em; /* Adjusted size */
            color: #333;
        }

        #script-form .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px; /* Reduced margin */
        }

        #script-form .form-row label {
            flex-basis: 90px; /* Adjusted width */
            flex-shrink: 0;
            margin-right: 10px; /* Reduced margin */
            font-weight: normal;
            color: #333;
            text-align: left;
        }

        #script-form .form-row input[type="text"],
        #script-form .form-row input[type="date"] {
            flex-grow: 1;
            padding: 8px; /* Adjusted padding */
            border: 1px solid #8c9db0;
            background-color: #e6f0f7;
            box-sizing: border-box;
        }

        #script-form button[type="submit"] { /* Submit button for stock info */
            display: block;
            width: 100%;
            padding: 10px; /* Adjusted padding */
            background-color: #28a745; /* Green for submit */
            border: 1px solid #218838;
            color: white;
            font-size: 1.05em;
            margin-top: 20px; /* Adjusted margin */
        }
        #script-form button[type="submit"]:hover { background-color: #218838; }

        #response { /* Response for stock info form */
            margin-top: 15px;
            padding: 8px 12px;
            border: 1px solid #d0d0d0;
            background-color: #f8f8f8;
            min-height: 20px;
            text-align: center;
            font-size: 0.9em;
            border-radius: 4px;
            line-height: 1.4;
        }
        #response:empty { border-style: dashed; border-color: #e0e0e0; color: #999; }
        #response.success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        #response.error { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }


        /* === New Layout Styles === */
        .top-forms-container {
            display: flex;
            gap: 20px;
            margin: 20px;
            align-items: flex-start;
        }

        .volatility-calc-panel {
            flex: 0 0 300px; /* Slightly wider if needed */
            padding: 15px;
            border: 1px solid #b0b0b0;
            border-radius: 5px;
            background-color: #ffffff; /* White background */
        }

        .volatility-calc-panel h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em; /* Adjusted size */
            color: #333;
        }

        .calc-tool-group { margin-bottom: 15px; }
        .calc-tool-group:last-child { margin-bottom: 0; }

        .calc-tool-group h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            color: #444;
        }

        .calc-tool-group .input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .calc-tool-group .input-row label {
            flex-basis: 60px; /* Compact label */
            font-weight: normal;
            font-size: 0.95em;
        }

        .calc-tool-group .input-row input[type="number"] {
            flex-grow: 1;
            padding: 6px; /* Compact input */
            box-sizing: border-box;
        }

        .calc-tool-group button[type="submit"] { /* SMA/EWMA Plot buttons */
            width: 100%;
            padding: 8px 10px;
            background-color: #6c757d; /* Neutral dark gray */
            border-color: #6c757d;
            font-size: 0.95em;
        }
        .calc-tool-group button[type="submit"]:hover { background-color: #5a6268; }

        .response-message { /* Common class for SMA/EWMA responses */
            font-size: 0.85em;
            margin-top: 8px;
            padding: 6px;
            min-height: 1.2em;
            text-align: center;
            border-radius: 3px;
            border: 1px solid transparent; /* Prepare for border */
        }
        .response-message:empty { display: none; }
        .response-message.success { color: #155724; background-color: #d4edda; border-color: #c3e6cb;}
        .response-message.error   { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .response-message.warning { color: #856404; background-color: #fff3cd; border-color: #ffeeba; }


        .stock-info-panel-main {
            flex: 1 1 auto;
        }

        .chart-display-area {
            margin: 0 20px 20px 20px;
            padding: 15px;
            border: 1px solid #b0b0b0;
            border-radius: 5px;
            background-color: #ffffff;
        }

        #clear-chart-button {
            display: block;
            margin: 0 auto 15px auto;
            padding: 8px 15px;
            background-color: #dc3545; /* Red for clear/delete actions */
            border-color: #dc3545;
        }
        #clear-chart-button:hover { background-color: #c82333; }

        #vol_chart {
            width: 100% !important;
            /* height: 400px !important; You might set a fixed height or use aspectRatio in JS */
            /* For responsive height, Chart.js often needs aspect ratio or explicit height on canvas parent */
            max-height: 500px; /* Example max height */
        }

        .diagnostics-and-modeling-area {
            margin: 0 20px 20px 20px;
            padding: 20px;
            border: 1px solid #b0b0b0;
            border-radius: 5px;
            background-color: #ffffff;
        }
        .diagnostics-and-modeling-area h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
            color: #333;
        }

        .diagnostics-and-modeling-area .tool-panel {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #fdfdfd;
        }
        .diagnostics-and-modeling-area .tool-panel:last-child { margin-bottom: 0; }

        .diagnostics-and-modeling-area .tool-panel h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #444;
        }

        .diagnostics-and-modeling-area #find-PACF button { /* PACF buttons */
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 8px 12px;
            background-color: #17a2b8; /* Info blue */
            border-color: #17a2b8;
        }
         .diagnostics-and-modeling-area #find-PACF button:hover { background-color: #138496; }

        .diagnostics-and-modeling-area #find-PACF p.description { /* Description for PACF section */
            font-size: 0.9em;
            color: #555;
            margin-bottom: 15px;
        }

        #response-pacf.data-output-area {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.9em;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            background-color: #fff;

            max-height: 350px;  
            min-height: 100px; 
            overflow-y: auto;  
            overflow-x: hidden; 

            text-align: center; 
        }

        #response-pacf.data-output-area:empty::before {
            content: "PACF data will appear here.";
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%; 
            color: #777;
        }

        #response-pacf.data-output-area:not(:empty)::before {
            content: none;
        }

        .pacf-lag-row {
            padding: 4px 8px; 
            margin-bottom: 2px;
            border-radius: 3px;
            line-height: 1.4;
            white-space: nowrap; 
            overflow-x: auto;

        }

        .pacf-lag-row.significant {
            background-color: lightgreen;
            color: #006400;
        }
        .pacf-lag-row.not-significant {
            background-color: lightcoral;
            color: #8B0000;
        }
        .pacf-lag-row.lag-zero {
            background-color: #f0f0f0;
            color: #555;
        }

        #response-pacf.data-output-area h4 { 
            text-align: center;
            margin-top: 0; 
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #333;
        }

        #response-pacf.data-output-area .error-message-text { 
            color: #a94442;
            background-color: #f2dede;
            border: 1px solid #ebccd1;
            padding: 8px;
            border-radius: 3px;
            text-align: left; 
        }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="menu-container">
            <button class="menu-button" aria-haspopup="true" aria-expanded="false" title="Navigation Menu">â˜°</button>
            <div class="dropdown-content">
                <p>Navigation links (not yet implemented)</p>
            </div>
        </div>
        <h1 class="header-title">Volatility Analysis</h1>
    </header>

    <div class="top-forms-container">
        <aside class="volatility-calc-panel">
            <h2>Calculate Volatility</h2>

            <div class="calc-tool-group" id="sma-tool-group">
                <h3>SMA</h3>
                <form id="SMA-volatility">
                    <div class="input-row">
                        <label for="sma-window-input">Window:</label>
                        <input type="number" id="sma-window-input" name="window" placeholder="20" value="20" required>
                    </div>
                    <button type="submit">Plot SMA</button>
                </form>
                <p class="response-message" id="response-sma"></p>
            </div>

            <div class="calc-tool-group" id="ewma-tool-group">
                <h3>EWMA</h3>
                <form id="EWMA-volatility">
                    <div class="input-row">
                        <label for="ewma-alpha-input">Alpha:</label>
                        <input type="number" id="ewma-alpha-input" name="alpha" min="0" max="1" step="0.01" placeholder="0.94" value="0.94" required>
                    </div>
                    <button type="submit">Plot EWMA</button>
                </form>
                <p class="response-message" id="response-ewma"></p>
            </div>
        </aside>

        <main class="stock-info-panel-main">
            <div class="form-box-container" id="stock-info-form-area">
                <form id="script-form">
                    <h1>Stock Information</h1>
                    <div class="form-row">
                        <label for="ticker">Ticker</label>
                        <input type="text" id="ticker" name="ticker" placeholder="Enter ticker symbol" value="SPY" required>
                    </div>
                    <div class="form-row">
                        <label for="start_date">Start Date</label>
                        <input type="date" id="start_date" name="start_date" value="2024-01-01" required>
                    </div>
                    <div class="form-row">
                        <label for="end_date">End Date</label>
                        <input type="date" id="end_date" name="end_date" value="2024-11-01" required>
                    </div>
                    <button type="submit">Submit</button>
                </form>
                <p id="response"></p>
            </div>
        </main>
    </div>

    <div class="chart-display-area">
        <button type="button" id="clear-chart-button">Clear Chart</button>
        <canvas id="vol_chart" aria-label="Historic_volatility_Chart"></canvas>
    </div>

    <div class="Garch Model Fitting">
        <h2>Diagnostic Tools & Model Fitting</h2>
        <div class="tool-panel" id="pacf-analysis-panel"> <!-- Changed from pacf-panel for clarity -->
            <h3>PACF Data</h3>
            <form id="find-PACF">
                <p class="description">Get PACF data to help determine GARCH model parameters (p, q). This will output the raw PACF values.</p>
                <button type="submit" id="plot-pacf-sq-returns">Get PACF (Squared Returns)</button>
            </form>
            <div id="response-pacf" class="data-output-area">
                <!-- PACF data/residuals will be displayed here as text -->
            </div>
        </div>
        <!-- Future GARCH/EGARCH model forms will go here -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colors@0.2.0"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/vol_chart.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getstockreturns.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getsma.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getewma.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/pacf.js')}}"></script>
</body>
</html>