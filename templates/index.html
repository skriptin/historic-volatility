<!DOCTYPE = html>
<html lang ="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Volatility Analysis</title>

        <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/stockbar.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/maincontent.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/toolbar.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/modelbuilder.css') }}">
    </head>

    <body>
        <!--Site header-->
        <header class="site-header">
            <div class="menu-container">
                <button class="menu-button" aria-haspopup="true" aria-expanded="false" title="Navigation Menu">☰</button>
                <div class="dropdown-content">
                    <p>Navigation links (not yet implemented)</p>
                </div>
            </div>
            <h1 class="header-title">Volatility Analysis</h1>
        </header>

        <!--Container for the user to fetch the period and instrument to perform the voltaility analysis-->
        <div class="stock-info-input-panel">
                <form id="script-form">
                    <label for="ticker">Ticker:</label>
                    <input type="text" id="ticker" name="ticker" placeholder="e.g. SPY" value="SPY" required>
                    <label for="start_date">Date range, from:</label>
                    <input type="date" id="start_date" name="start_date" value="2024-01-01" required>
                    <label for="end_date">to:</label>
                    <input type="date" id="end_date" name="end_date" value="2024-11-01" required>
                    <button type="submit" id="get_returns">Fetch</button>
                </form>
        </div>

        <!--Main app container-->
        <main class="app-main-content">
            <div class="chart-and-toolbars-wrapper">
                <!-- Left Toolbar -->
                <aside class="chart-toolbar no-icon">

                    <button id="resize-btn">Resize</button>

                    <ul class="model-list">


                        <!--Prototype model-->
                        <!-- <li class="model-info">
                            <div class="model-box">
                                <h3 class="item-name">Model Name: GARCH_Model_1</h3>

                                <div class="model-summary">
                                    <p><strong>Date:</strong> Aug 19 2025</p>
                                    <p><strong>Mean Model:</strong> AR</p>
                                    <p><strong>Volatility Model:</strong> GARCH</p>
                                    <p><strong>Distribution:</strong> Skew t</p>
                                    <p><strong>Observations:</strong> 1256</p>
                                    <p><strong>Log-Likelihood:</strong> -1562.61</p>
                                    <p><strong>AIC:</strong> 3139.21</p>
                                    <p><strong>BIC:</strong> 3175.16</p>
                                    <p><strong>R-squared:</strong> 0.002</p>
                                </div>

                                <div class="group-title">Volatility Parameters</div>
                                <table class="parameter-table">
                                    <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th class="numeric">Value</th>
                                        <th class="numeric">Std Err</th>
                                        <th class="numeric">p-value</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>alpha[1]</td>
                                        <td class="numeric">0.14476</td>
                                        <td class="numeric">0.02734</td>
                                        <td class="numeric">1.2e-7</td>
                                    </tr>
                                    <tr>
                                        <td>beta[1]</td>
                                        <td class="numeric">0.82963</td>
                                        <td class="numeric">0.02610</td>
                                        <td class="numeric">1.17e-221</td>
                                    </tr>
                                    <tr>
                                        <td>omega</td>
                                        <td class="numeric">0.03114</td>
                                        <td class="numeric">0.00872</td>
                                        <td class="numeric">0.00035</td>
                                    </tr>
                                    </tbody>
                                </table>

                                <div class="group-title">Mean Parameters</div>
                                <table class="parameter-table">
                                    <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th class="numeric">Value</th>
                                        <th class="numeric">Std Err</th>
                                        <th class="numeric">p-value</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>Const</td>
                                        <td class="numeric">0.08896</td>
                                        <td class="numeric">0.02190</td>
                                        <td class="numeric">4.86e-5</td>
                                    </tr>
                                    <tr>
                                        <td>y[1]</td>
                                        <td class="numeric">-0.05705</td>
                                        <td class="numeric">0.02783</td>
                                        <td class="numeric">0.04038</td>
                                    </tr>
                                    </tbody>
                                </table>

                                <div class="item-actions">
                                    <label for="forecast-days-GARCH_Model_1">Days to forecast:</label>
                                    <input type="number" id="forecast-days-GARCH_Model_1" name="forecast_days" min="1" placeholder="e.g. 30">
                                    <button class="forecast-btn" data-model="GARCH_Model_1">Forecast</button>
                                    <button class="plot-btn" data-model="GARCH_Model_1">Plot</button>
                                    <button class="save-btn" data-model="GARCH_Model_1">Save</button>
                                </div>
                            </div>
                        </li> -->

                        <!--Volatility models will be inserted here-->


                    </ul>

                </aside>

                <!-- Chart Display Area -->
                <div class="chart-display-area">
                    <canvas id="vol_chart" aria-label="Historic Volatility Chart"></canvas>

                    <div class="chart-toolbar-button-wrapper">
                        <button type="button" class="toolbar-button studies" id="open-studies-tab" title="view studies"> Studies</button>
                        <button type="button" class="toolbar-button series" id="open-series-tab" title="view series"> Series</button>
                        <button type="button" class="toolbar-button pacf" id="calculate-pacf" title="calculate-pacf"> PACF</button>
                        <button type="button" class="toolbar-button model_builder" id="model-builder-view" title="build models"> Model Builder</button>
                    </div>
                </div>
            </div>


            <!--Studies popup buttons and forum elements-->
            <div id="studies-popup" class="popup-menu studies">
                <form id="SMA-volatility">
                    <label for="window">SMA</label>
                    <input
                        type="number" id="window" name="window" class ="studies-input-field" 
                        value="20" title="Enter window length" required 
                    >
                    <button type="submit" id="get_sma" class ="studies-button">Fetch</button>
                </form>
                <form id="EWMA-volatility">
                    <label for="ewma-alpha">EWMA</label>
                    <input
                        type="float" id="ewma-alpha" name="ewma-alpha" class ="studies-input-field" 
                        value="0.2" title="Enter alpha, alpha between 0 and 1" required 
                    >
                    <button type="submit" id="get_ewma" class ="studies-button">Fetch</button>
                </form>
            </div>

            <!--Seires button, this is where the user can remove currently plotted data sets and add similar volatility indicies such as the VIX-->
            <div id="series-popup" class="popup-menu series">

                <div class="popup-content">

                    <div id="volatility-indicies-trigger" class ="submenu-trigger">
                        <span class="trigger-label">Volatility indicies</span>
                        <span class="trigger-arrow">▶</span>
                    </div>

                    <div id="volatility-indicies-submenu" class="submenu-content"> 
                        
                        <div class="submenu-item"> 
                            <span class="item-label">SMP500 Volatility Index(VIX)</span>
                            <button type="button" class="add-item-button" data-index-symbol="^VIX" data-index-name = "CBOE SMP500 Volatility Index">Add</button>
                        </div>

                        <div class="submenu-item">  
                            <span class="item-label">NASDAQ-100 Volatility Index(VXN)</span>
                            <button type="button" class="add-item-button" data-index-symbol="^VXN" data-index-name = "CBOE NASDAQ 100 Volatility Index">Add</button>
                        </div>

                        <div class="submenu-item">  
                            <span class="item-label">DIJA Volatility Index(VXD)</span>
                            <button type="button" class="add-item-button" data-index-symbol="^VXD" data-index-name = "CBOE DIJA Volatility Index">Add</button>
                        </div>
                        
                        <p style="font-size: 0.8em; color: #777; margin-top: 10px;">More indices...</p>
                    </div>
                                <ul id="plotted-series-list" class="series-list">
                    <!--Elements will be dynamically inserted and removed into this element ie:
                        <li data-dataset-label="EWMA(0.90)">
                            <span>EWMA(0.90)</span>
                            <button class="remove-series-button" title="Remove EWMA(0.90)">×</button>
                        </li> 
                    -->
                    </ul>
                </div>
            </div>

            <div id="pacf-popup" class="popup-menu pacf">
            
                <div class="popup-content pacf">
                    <div class="pacf-form-container">
                        <h2>PACF Configuraiton</h2>
                        <form id="pacf-form">
                            <label for="n-lags">n-Lags:</label>
                            <input type="number" id="n-lags" name="n-lags" value="30" required>
                            <label for="pacf-alpha">alpha:</label>
                            <input type="number" id="pacf-alpha" name="pacf-alpha" value="0.05" required>
                            <button type="submit" id="get_pacf">Submit</button>
                        </form>
                    </div>
                    <div class="pacf-view-button-wrapper">
                        <button type="button" id="view-pacf-plot-button">View</button>
                    </div>
                </div>
            </div>

        <!-- PACF Plot Popup (positioned absolutely next to the View button) -->
        <div id="pacf-modal-popup" class="popup pacf-modal">
            <div class="popup__header">
                <h4 class="popup__title">PACF Plot</h4>
                <button type="button" class="popup__close" id="close-pacf-modal">x</button>
            </div>
            <div class="popup__content">
                <img id="pacf-img-plot" src="" alt="PACF Plot will appear here" />
                <div id="response-pacf" class="popup__response"></div>
            </div>
        </div>


        <div id="model-builder-popup" class="popup-menu model-builder">
            <div id="model-builder-header" class="model-builder-header">
                <h2 id="model-header">Model Builder</h2>
                <button id="dropdown-btn" class="dropdown-btn">▼</button>
            </div>
                <ul id="dropdown-list" class="dropdown-list"></ul>
            <!-- All model‐forms start hidden -->
            <div id="garch-div" class="model-form" style="display: none;">
                <form id="garch-form">
                    <fieldset>
                        <h2>Date Ranges</h2>
                        <div class="scroll-box" id="dateListContainer"></div>
                        <input type="text" id="date-list" placeholder="YYYY-MM-DD YYYY-MM-DD" style="width: 100%;">
                        <input type="hidden" name="dateRanges" id="dateRangesInput">
                        <button type="button" id="add-date-range-button">Add</button>
                    </fieldset>

                    <fieldset>
                        <legend>Mean Model</legend>
                        <div class="form-grid">
                            <label for="mean-model">Mean:</label>
                            <select id="mean-model" name="mean-model">
                                <option value="constant">Constant</option>
                                <option value="zero">Zero</option>
                                <option value="AR">AR</option>
                                <option value="ARX">ARX</option>
                                <option value="HARX">ARMA</option>
                            </select>

                            <label for="lags">Lags:</label>
                            <input type="text" id="lags" name="lags" value="1" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Distribution</legend>
                        <select id="distribution" name="distribution">
                            <option value="normal">Normal</option>
                            <option value="skewt">Skewt</option>
                        </select>
                    </fieldset>

                    <fieldset>
                        <legend>Model Name</legend>
                        <input type="text" id="model-name" name="model-name" placeholder="Enter model name" required>
                    </fieldset>

                    <fieldset>
                        <legend>Parameters</legend>
                        <div class="form-grid">
                            <label for="p">p:</label>
                            <input type="number" id="p" name="p" value="1" required>

                            <label for="q">q:</label>
                            <input type="number" id="q" name="q" value="1" required>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" id="model-builder-submit">Train Model</button>
                    </div>

                </form>
            </div>

            <div id="egarch-div" class="model-form" style="display: none;">
                <form id="egarch-form">
                    <fieldset>
                        <h2>Date Ranges</h2>
                        <div class="scroll-box" id="dateListContainer"></div>
                        <input type="text" id="date-list" placeholder="YYYY-MM-DD YYYY-MM-DD" style="width: 100%;">
                        <input type="hidden" name="dateRanges" id="dateRangesInput">
                        <button type="button" id="add-date-range-button">Add</button>
                    </fieldset>

                    <fieldset>
                        <legend>Mean Model</legend>
                        <div class="form-grid">
                            <label for="mean-model">Mean:</label>
                            <select id="mean-model" name="mean-model">
                                <option value="constant">Constant</option>
                                <option value="zero">Zero</option>
                                <option value="AR">AR</option>
                                <option value="ARX">ARX</option>
                                <option value="HARX">ARMA</option>
                            </select>

                            <label for="lags">Lags:</label>
                            <input type="text" id="lags" name="lags" value="1" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Distribution</legend>
                        <select id="distribution" name="distribution">
                            <option value="normal">Normal</option>
                            <option value="skewt">Skewt</option>
                        </select>
                    </fieldset>

                    <fieldset>
                        <legend>Model Name</legend>
                        <input type="text" id="model-name" name="model-name" placeholder="Enter model name" required>
                    </fieldset>

                    <fieldset>
                        <legend>Parameters</legend>
                        <div class="form-grid">
                            <label for="p">p:</label>
                            <input type="number" id="p" name="p" value="1" required>

                            <label for="q">q:</label>
                            <input type="number" id="q" name="q" value="1" required>

                            <label for="'o">o:</label>
                            <input type="'number" id="o" name="o" value="1" required>      
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" id="model-builder-submit">Train Model</button>
                    </div>
                </form>
            </div>

            <div id="apgarch-div" class="model-form" style="display: none;">
                <form id="apgarch-form">
                    <fieldset>
                        <h2>Date Ranges</h2>
                        <div class="scroll-box" id="dateListContainer"></div>
                        <input type="text" id="date-list" placeholder="YYYY-MM-DD YYYY-MM-DD" style="width: 100%;">
                        <input type="hidden" name="dateRanges" id="dateRangesInput">
                        <button type="button" id="add-date-range-button">Add</button>
                    </fieldset>

                    <fieldset>
                        <legend>Mean Model</legend>
                        <div class="form-grid">
                            <label for="mean-model">Mean:</label>
                            <select id="mean-model" name="mean-model">
                                <option value="constant">Constant</option>
                                <option value="zero">Zero</option>
                                <option value="AR">AR</option>
                                <option value="ARX">ARX</option>
                                <option value="HARX">ARMA</option>
                            </select>

                            <label for="lags">Lags:</label>
                            <input type="text" id="lags" name="lags" value="1" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Distribution</legend>
                        <select id="distribution" name="distribution">
                            <option value="normal">Normal</option>
                            <option value="skewt">Skewt</option>
                        </select>
                    </fieldset>

                    <fieldset>
                        <legend>Model Name</legend>
                        <input type="text" id="model-name" name="model-name" placeholder="Enter model name" required>
                    </fieldset>

                    <fieldset>
                        <legend>Parameters</legend>
                        <div class="form-grid">
                            <label for="p">p:</label>
                            <input type="number" id="p" name="p" value="1" required>

                            <label for="q">q:</label>
                            <input type="number" id="q" name="q" value="1" required>

                            <label for="o">o:</label>
                            <input type="number" id="o" name="'o" value="1" required>

                            <label for="power">Power:</label>
                            <input type="number" id="power" name="power" value="2.0" required>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" id="model-builder-submit">Train Model</button>
                    </div>
                </form>
            </div>

            <div id="harch-div" class="model-form" style="display: none;">
                <form id="harch-form">
                    <fieldset>
                        <h2>Date Ranges</h2>
                        <div class="scroll-box" id="dateListContainer"></div>
                        <input type="text" id="date-list" placeholder="YYYY-MM-DD YYYY-MM-DD" style="width: 100%;">
                        <input type="hidden" name="dateRanges" id="dateRangesInput">
                        <button type="button" id="add-date-range-button">Add</button>
                    </fieldset>

                    <fieldset>
                        <legend>Mean Model</legend>
                        <div class="form-grid">
                            <label for="mean-model">Mean:</label>
                            <select id="mean-model" name="mean-model">
                                <option value="constant">Constant</option>
                                <option value="zero">Zero</option>
                                <option value="AR">AR</option>
                                <option value="ARX">ARX</option>
                                <option value="HARX">ARMA</option>
                            </select>

                            <label for="lags">Lags:</label>
                            <input type="text" id="lags" name="lags" value="1" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Distribution</legend>
                        <select id="distribution" name="distribution">
                            <option value="normal">Normal</option>
                            <option value="skewt">Skewt</option>
                        </select>
                    </fieldset>

                    <fieldset>
                        <legend>Model Name</legend>
                        <input type="text" id="model-name" name="model-name" placeholder="Enter model name" required>
                    </fieldset>

                    <fieldset>
                        <legend>Parameters</legend>
                        <div class="form-grid">
                            <label for="lags_vol">Vol lags:</label>
                            <input type="text" id="lags_vol" name="lags_vol" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" id="model-builder-submit">Train Model</button>
                    </div>
                </form>
            </div>

            <div id="figarch-div" class="model-form" style="display: none;">
                <form id="figarch-form">
                    <fieldset>
                        <h2>Date Ranges</h2>
                        <div class="scroll-box" id="dateListContainer"></div>
                        <input type="text" id="date-list" placeholder="YYYY-MM-DD YYYY-MM-DD" style="width: 100%;">
                        <input type="hidden" name="dateRanges" id="dateRangesInput">
                        <button type="button" id="add-date-range-button">Add</button>
                    </fieldset>

                    <fieldset>
                        <legend>Mean Model</legend>
                        <div class="form-grid">
                            <label for="mean-model">Mean:</label>
                            <select id="mean-model" name="mean-model">
                                <option value="constant">Constant</option>
                                <option value="zero">Zero</option>
                                <option value="AR">AR</option>
                                <option value="ARX">ARX</option>
                                <option value="HARX">ARMA</option>
                            </select>

                            <label for="lags">Lags:</label>
                            <input type="text" id="lags" name="lags" value="1" title="e.g, 1 or 1, 2, ... n">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Distribution</legend>
                        <select id="distribution" name="distribution">
                            <option value="normal">Normal</option>
                            <option value="skewt">Skewt</option>
                        </select>
                    </fieldset>

                    <fieldset>
                        <legend>Model Name</legend>
                        <input type="text" id="model-name" name="model-name" placeholder="Enter model name" required>
                    </fieldset>

                    <fieldset>
                        <legend>Parameters</legend>
                        <div class="form-grid">
                            <label for="p">p:</label>
                            <input type="number" id="p" name="p" value="1" required>

                            <label for="q">q:</label>
                            <input type="number" id="q" name="q" value="1" required>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" id="model-builder-submit">Train Model</button>
                    </div>
                </form>
            </div>

            
        </div>

        
            
    </main>


    <!--Script area, all javascrips imported here for neatness-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colors@0.2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>

    <script type="module" src="{{ url_for('static', filename='scriptsjs/vol_chart.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getstockreturns.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getsma.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/getewma.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/pacf.js')}}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/ui_interactions.js')}}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/series.js')}}"></script>
    <script type="module" src="{{ url_for('static', filename='scriptsjs/modelbuilder.js')}}"></script>


    </body>
</html>